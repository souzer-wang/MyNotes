### 13.索引、索引的作用和索引的优缺点是什么，什么样的字段适合建索引？

数据库索引，是数据库管理系统中一个排序的数据结构，索引的实现通常使用B树及其变种B+树。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法。这种数据结构，就是索引。

索引的作用：协助快速查询、更新数据库表中数据。

索引的优点：

-   索引可以保证数据每一行的唯一性
    
-   加快数据的检索速度，降低数据库的IO成本
    

缺点：

-   创建和维护索引需要时间
    
-   索引需要占用物理空间，增加空间成本
    
-   对数据进行增、删、改的时候需要动态维护
    

唯一的，不为空的，经常被查询的字段适合建立索引

### 14.B+树的索引和Hash索引的区别？

hash索引是键值对的索引，检索效率非常高；B+树索引需要从根节点到枝节点索引，最后才能访问到数据。

为什么不都用Hash索引而使用B+树索引？

Hash索引仅仅能满足"=","IN"和""查询，不能使用范围查询，hash是索引也不能用来做排序操作，hash的索引不能利用部分索引键查询。

### 15.B树和B+树的区别，为什么MySQL会用B+树?

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/vI9nYe94fsEorJ2oVibEB49RdbyXWEBk0lloemZq97lOhkG98WA4txibicMhz6gxGmicnibZ5dIMNKKuQSPTRkZhTug/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

B树

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/vI9nYe94fsEorJ2oVibEB49RdbyXWEBk0MBUzgUBmOCGtDgAI5oEUKBk230hxn82Ep1vc8TicscPqG7RrRt3Dnaw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

B+树

B树，每个节点都存储key和data，所有节点组成这棵树，并且叶子节点指针为nul，叶子结点不包含任何关键字信息。

B+树，所有的叶子结点中包含了全部关键字的信息，及指向含有这些关键字记录的指针，且叶子结点本身依关键字的大小自小而大的顺序链接，所有的非终端结点可以看成是索引部分，结点中仅含有其子树根结点中最大（或最小）关键字。

### 为什么MySQL用B+树呢？

-   B+ 树查询效率更稳定（因为因为B+ 树每次只有访问到叶子节点才能找到对应的数据 而在 B 树中 非叶子节点也会存储数据）
    
-   B+ 树的查询效率更高 （因为通常B+ 树比 B 树更矮胖 阶数更大 深度更低 查询所需要的磁盘 I/O 也会更少 。同样的磁盘页大小 B+ 树可以存储更多的节点关键字）
    
-   对索引进行范围查询时 B+ 树效率也更高（因为所有关键字都出现在B+ 树的叶子节点中 并通过有序链表进行了链接 。而在 B 树中则需要通过中序遍历才能完成范围查找 效率要低很多）
    

### 为什么MongoDB要用B树呢？

MongoDB 的默认存储引擎WiredTiger 使用B树作为底层的索引结构，但也支持LSM树。

#### 那么为什么B+树和LSM树没有成为WiredTiger默认引擎呢？
- 作为非关系型的数据库，MongoDB对于遍历数据的需要不高，它追求更多的是读写单个记录的功能
- 大多数数据库面对的是 读多写少 的场景，B 树 和 LSM 树在该场景下优势更大

> MySQL 中使用 B+ 树是因为：
>- B+ 树只有叶节点会存储数据，
>- 将树中的每一个叶节点通过指针连接起来就能实现顺序遍历，
>- 而遍历数据在关系型数据库中非常常见，所以这么选择是完全没有问题的。

换句话说：

> MySQL 认为遍历索引非常重要，而单个查询没那么重要
> 所以 选择了B+树索引，舍弃了非叶节点存储数据的特性

而，

> MongoDB 认为遍历索引重要，但单个查询更重要，而 B 树
> - 非叶节点也存数据，查询单个节点的IO次数比B+树少
> 
> 这样，用了B树，MongoDB查询单个数据就比MySQL更快
> （不是说MongoDB不需要遍历查询，也需要，但为了更快的单个数据查询，它可以忍受遍历查询比MySQL慢一点）

#### 那既然MongoDB看重单个查询，为什么不用哈希索引捏？

因为哈希实现遍历查询的表现实在太差了，MongoDB 虽然看重单个查询，但也没放弃遍历查询。

|复杂度|单条查询|遍历查询|
|:-:|:-:|:-:|
|哈希索引|O(1)|O(n)|
|B+树|O(logn)|O(logn)+X|

